<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>トピクリ</title>
    <link rel="stylesheet" href="https://unpkg.com/ress/dist/ress.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.4/css/all.css">
</head>

<body>
    <header>
        <div class="header">
            <div class="buttons">
                <a href="index.html" class="home">
                    <div class="home_button iconBtn">
                        <i class="fas fa-home fa-2x fa-fw my-orange e_icon"></i>
                        <p class="home-text">ホーム</p>
                    </div>
                </a>
                <div class="home">
                    <div class="clear_button">
                        <i class="fas fa-trash-alt fa-2x fa-fw my-orange e_icon"></i>
                        <p class="clear-text">クリア</p>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <main class="main">
        <h2>ホーム</h2>
        <div class="hide" id="result"></div>
        <ul class="hide" id="result2"></ul>
        <div id="btns" class="collection">
            <img id="startbtn" class="startbtn" src="images/start_recording.png" alt="">
            <img id="stopbtn" class="stopbtn hide" src="images/during_recording2.png" alt="">
        </div>
        <div id="pagetop"><a href="#"></a></div>
        <div class="notepad_box">
            <div class="notepad1 opacity">
                <div class="np_children np_bg np_bg1"></div>
                <img class="np_children np_img" src="images/get_a_word_f0f8ff.png" alt="メモ帳">
                <span class="np_children np_word1"></span>
            </div>
            <div class="notepad2 opacity">
                <div class="np_children np_bg np_bg2"></div>
                <img class="np_children np_img" src="images/get_a_word_f0f8ff.png" alt="メモ帳">
                <span class="np_children np_word2"></span>
            </div>
            <div class="notepad3 opacity">
                <div class="np_children np_bg np_bg3"></div>
                <img class="np_children np_img" src="images/get_a_word_f0f8ff.png" alt="メモ帳">
                <span class="np_children np_word3"></span>
            </div>
            <div class="notepad4 opacity">
                <div class="np_children np_bg np_bg4"></div>
                <img class="np_children np_img" src="images/get_a_word_f0f8ff.png" alt="メモ帳">
                <span class="np_children np_word4"></span>
            </div>
            <div class="notepad5 opacity">
                <div class="np_children np_bg np_bg5"></div>
                <img class="np_children np_img" src="images/get_a_word_f0f8ff.png" alt="メモ帳">
                <span class="np_children np_word5"></span>
            </div>
        </div>

        <div id="search_box">
        </div>

    </main>
    <footer>
    </footer>
    <script src="script.js"></script>
    <script>
        SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;
        const recognition = new SpeechRecognition();
        const start_btn = document.querySelector('#startbtn');
        const stop_btn = document.querySelector('#stopbtn');
        const results_div = document.querySelector('#result');
        const results_div2 = document.querySelector('#result2');
        // const extract_btn = document.querySelector('#extractbtn');

        let recognitionHouse;
        let shiftCount = 0;

        recognition.lang = 'ja-JP';
        recognition.interimResults = true;
        recognition.continuous = true;

        let finalTranscript = '';

        recognition.onresult = (event) => {
            let interimTranscript = '';
            for (let i = event.resultIndex; i < event.results.length; i++) {
                let transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    finalTranscript += transcript;
                } else {
                    interimTranscript = transcript;
                }
            }
            recognitionHouse = finalTranscript + interimTranscript;
            r = /[一-龠]+|[ぁ-ん]+|[ァ-ヴー]+|[a-zA-Z0-9]+|[ａ-ｚＡ-Ｚ０-９]+/g;
            // console.log(event.results[0][0].transcript);
            // console.log(event.results);
        }
        start_btn.onclick = () => {
            // console.log(extract_btn);
            // console.log(recognitionHouse);
            recognition.start();
            function countUp() {
                let RDI = recognitionHouse;
                let resultL = RDI.match(r);
                console.log(resultL);
                resultL.forEach(word => {
                    extractionArray = resultL.concat();
                    const li = document.createElement('li');
                    li.innerHTML = word;
                    results_div.appendChild(li);
                    let timerID;
                    timerID = setTimeout(resultL, 3000);
                });
                for (let i = 0; i < shiftCount; i++) {
                    console.log(resultL);
                    console.log(extractionArray);
                    extractionArray.shift();
                }
                //ランダム色と付箋表示
                const shuffledChoiceColors = shuffle(colors);
                if (extractionArray.length >= 5) {
                    for (let i = 0; i < 5; i++) {
                        extraction(i, shuffledChoiceColors);
                        shiftCount += 1;
                    }
                } else if (extractionArray.length < 5 && extractionArray.length > 0) {
                    for (let i = 0; i < extractionArray.length; i++) {
                        extraction(i, shuffledChoiceColors);
                        shiftCount += 1;
                    }
                }
                // console.log(shiftCount);
            }
            setInterval(countUp, 1500);
            // document.addEventListener('DOMContentLoaded', function () {
            // })
        }
        stop_btn.onclick = () => {

            clearInterval(intervalId);
            recognition.stop();
        }
    </script>
</body>

</html>